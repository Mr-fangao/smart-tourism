

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> layer/M3DLayer.js</title>

  <script src="../cdn/run_prettify.js"></script>
  <script src="../cdn/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="../cdn/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="../cdn/googleapis.css" rel="stylesheet">
  <link href="../cdn/prettify.css" rel="stylesheet">
  <link rel="stylesheet" href="../cdn/all.css" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="../cdn/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="../cdn/mapgis.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="../cdn/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
             
                <a class="image" href="/">
                    <img class="mapgis-webclient-logo" src="../image/mapgis_blue.png" alt="logo">
                </a>
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API
                </a>
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        帮助向导
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            
                                <a class="dropdown-item" href="tutorial-1.快速入门.html">
                                    1.快速入门
                                </a>
                            
                        
                        </div>
                    </div>
                </div>
                 
                    
                        <a
                            class="link user-link "
                            href="/docs/cesium/index.html"
                        >
                            Cesium
                        </a>
                    
                        <a
                            class="link user-link "
                            href="/docs/mapboxgl/index.html"
                        >
                            MapboxGL
                        </a>
                    
                        <a
                            class="link user-link "
                            href="/docs/leaflet/index.html"
                        >
                            Leaflet
                        </a>
                    
                        <a
                            class="link user-link "
                            href="/docs/openlayers/index.html"
                        >
                            OpenLayers
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            <div>
                <span class="mapgis-api-document-span"><a href="index.html">API文档</a></span>
            </div>
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="搜索文档..." class="input">
                </div>
            
            <nav>
                
                    <div class="category"><div class="mapgis-menu-span">模块</div><ul class="mapgis-sidebar-menus"><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E4%25BA%258B%25E4%25BB%25B6%25E7%25AE%25A1%25E7%2590%2586.html">客户端事件管理</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%2585%25AC%25E5%2585%25B1%25E6%2596%25B9%25E6%25B3%2595.html">客户端公共方法</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596.html">客户端可视化</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596%25E5%2588%2586%25E6%259E%2590.html">客户端可视化分析</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259C%258D%25E5%258A%25A1.html">客户端数据服务</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E6%25B8%25B2%25E6%259F%2593.html">客户端渲染</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E8%25A7%2586%25E5%259B%25BE%25E7%25AE%25A1%25E7%2590%2586.html">客户端视图管理</a></li><li><a href="module-%25E6%259C%258D%25E5%258A%25A1%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259F%25A5%25E8%25AF%25A2.html">服务端数据查询</a></li><li><a href="module-%25E7%2594%25A8%25E6%2588%25B7%25E7%2595%258C%25E9%259D%25A2.html">用户界面</a></li></ul><div class="mapgis-menu-span">类名</div><ul class="mapgis-sidebar-menus"><li><a href="BaseLayer%2520%25E6%2595%25B0%25E6%258D%25AE%25E6%259C%258D%25E5%258A%25A1%25E5%259F%25BA%25E7%25B1%25BB.html">BaseLayer 数据服务基类</a></li><li><a href="CesiumSelectionIndicator.html">CesiumSelectionIndicator</a></li><li><a href="MapGIS2dDocProvider.html">MapGIS2dDocProvider</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E4%25BA%258B%25E4%25BB%25B6%25E7%25AE%25A1%25E7%2590%2586.MouseEventManager.html">MouseEventManager</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%2585%25AC%25E5%2585%25B1%25E6%2596%25B9%25E6%25B3%2595.CommonDataManager.html">CommonDataManager</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%2585%25AC%25E5%2585%25B1%25E6%2596%25B9%25E6%25B3%2595.CommonFuncManager.html">CommonFuncManager</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596.EchartsLayer.html">EchartsLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596.EntityController.html">EntityController</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596.LabelLayer.html">LabelLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596.MapVLayer.html">MapVLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596.PopupController.html">PopupController</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596.PopupLayer.html">PopupLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596%25E5%2588%2586%25E6%259E%2590.AdvancedAnalysisManager.html">AdvancedAnalysisManager</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596%25E5%2588%2586%25E6%259E%2590.AnalysisManager.html">AnalysisManager</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259C%258D%25E5%258A%25A1.LayerManager.html">LayerManager</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259C%258D%25E5%258A%25A1.M3DLayer.html">M3DLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259C%258D%25E5%258A%25A1.OGCLayer.html">OGCLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259C%258D%25E5%258A%25A1.TerrainLayer.html">TerrainLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259C%258D%25E5%258A%25A1.ThirdPartyLayer.html">ThirdPartyLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259C%258D%25E5%258A%25A1.TilesLayer.html">TilesLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E6%25B8%25B2%25E6%259F%2593.VectorTileLayer.html">VectorTileLayer</a></li><li><a href="module-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E8%25A7%2586%25E5%259B%25BE%25E7%25AE%25A1%25E7%2590%2586.SceneManager.html">SceneManager</a></li><li><a href="module-%25E6%259C%258D%25E5%258A%25A1%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259F%25A5%25E8%25AF%25A2.G3DDocQuery.html">G3DDocQuery</a></li><li><a href="module-%25E6%259C%258D%25E5%258A%25A1%25E7%25AB%25AF%25E6%2595%25B0%25E6%258D%25AE%25E6%259F%25A5%25E8%25AF%25A2.MapDocQuery.html">MapDocQuery</a></li><li><a href="PopupElement.html">PopupElement</a></li><li><a href="WmtsTileProvider.html">WmtsTileProvider</a></li></ul><div class="mapgis-menu-span">全局</div><ul class="mapgis-sidebar-menus"><li><a href="global.html#addGridInfo">addGridInfo</a></li><li><a href="global.html#addImageLayer">addImageLayer</a></li><li><a href="global.html#calAngleOf3Pnt">calAngleOf3Pnt</a></li><li><a href="global.html#LayerType">LayerType</a></li><li><a href="global.html#removeAllEntities">removeAllEntities</a></li><li><a href="global.html#removeAllImageLayers">removeAllImageLayers</a></li><li><a href="global.html#removeAllPrimitives">removeAllPrimitives</a></li><li><a href="global.html#removeDocs">removeDocs</a></li><li><a href="global.html#removeEntity">removeEntity</a></li><li><a href="global.html#removeGridInfo">removeGridInfo</a></li><li><a href="global.html#removeImageLayer">removeImageLayer</a></li><li><a href="global.html#removeM3dLayer">removeM3dLayer</a></li><li><a href="global.html#removePrimitive">removePrimitive</a></li><li><a href="global.html#removeTerrain">removeTerrain</a></li><li><a href="global.html#updataPopupPosition">updataPopupPosition</a></li><li><a href="global.html#zoomToM3dLayer">zoomToM3dLayer</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <span class="page-title-sub">layer/M3DLayer.js</span>
                    <span class="page-title-main">Source</span>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { CesiumZondy } from '../core/Base';

import BaseLayer from './BaseLayer';
import LayerType from './LayerType';

/**
 * @author 基础平台研发中心·冯桂英
 * @class module:客户端数据服务.M3DLayer
 * @category  BaseLayer.M3DLayer
 * @classdesc M3DLayer M3D模型层管理类
 * @description M3D图层管理类,实现M3D模型层相关操作
 * @param optionsParam.viewer  场景视图
 */
export default class M3DLayer extends BaseLayer {
    constructor(optionsParam) {
        const options = optionsParam;
        super(options);
    }

    /**
     * @private
     * 添加三维场景m3d服务图层
     * @param {String} baseUrl 文档地址
     * @param {Number} renderIndex 图层渲染索引
     * @param {Number} layerIndex 图层索引
     * @param {String} gdbpUrl m3d文件索引地址
     * @param {Boolean} visible 是否可见
     * @param {Boolean} igserver 是否是igs服务
     * @param {Object} optionsParam
     * @param {Boolean} [optionsParam.autoReset = true] 是否自动定位
     * @param {Boolean} [optionsParam.synchronous = true] 是否异步请求
     * @param {Function} [optionsParam.loaded = function] 回调函数
     * @param {DefaultProxy} [optionsParam.proxy = defaultProxy] 代理
     * @returns m3d层对象
     * @example
     * function callBackfunction(layer){
     * console.log(layer)
     * }
     * appendM3DLayer(baseUrl, renderIndex, layerIndex, gdbpUrl, visible, igserver, {
     * autoReset:false,
     * debugShowBoundingVolume:false,
     * maximumScreenSpaceError:16
     * });
     */
    appendM3DLayer(baseUrl, renderIndex, layerIndex, gdbpUrl, visible, igserver, optionsParam) {
        const options = Cesium.defaultValue(optionsParam, {});
        const dataUrl = `${baseUrl}/GetDataStreams?sceneIndex=0&amp;layerIndex=${renderIndex}&amp;Level=0&amp;Row=0&amp;Col=0`;
        const showBoundingVolume = Cesium.defaultValue(options.debugShowBoundingVolume, false);
        const maxScreenError = Cesium.defaultValue(options.maximumScreenSpaceError, 16);
        const debugShowMemoryUsage = Cesium.defaultValue(options.debugShowMemoryUsage, false);
        const debugShowUrl = Cesium.defaultValue(options.debugShowUrl, false);

        const m3dLayr = new Cesium.MapGISM3DSet({
            url: dataUrl,
            layerRenderIndex: renderIndex,
            layerIndex,
            gdbpUrl,
            show: visible,
            igserver,
            debugShowBoundingVolume: showBoundingVolume,
            maximumScreenSpaceError: maxScreenError,
            debugShowMemoryUsage,
            debugShowUrl
        });
        const tileset = this.viewer.scene.primitives.add(m3dLayr);
        const autoReset = Cesium.defaultValue(options.autoReset, true);
        if (autoReset) {
            tileset.readyPromise.then((layer) => this.zoomToM3dLayer(layer));
        }
        return tileset;
    }

    /**
     * 添加m3d文档服务
     * @function module:客户端数据服务.M3DLayer.prototype.append
     * @param {String}          url 服务地址
     * @param {Object}          optionsParam 包含以下参数
     * @param {Boolean}         [optionsParam.autoReset = true] 是否自动定位
     * @param {Boolean}         [optionsParam.synchronous = true] 是否异步请求
     * @param {Function}        [optionsParam.loaded = function] 回调函数
     * @param {DefaultProxy}    [optionsParam.proxy = defaultProxy] 代理
     * @param {Boolean}         [optionsParam.showBoundingVolume = false] 是否显示包围盒
     * @param {Number}          [optionsParam.maximumScreenSpaceError = 16] 用于控制模型显示细节  值较大将会渲染更少的贴图,进而可以提高性能,而较低的值将提高视觉质量
     * @param {String}          [options.layers=undefined] 图层过滤功能
     * @see {@link https://cesium.com/docs/cesiumjs-ref-doc/Cesium3DTileset.html}
     * @returns {Array&lt;MapGISM3DSet>} 返回m3d图层对象数组,长度为图层对象个数
     * @example
     *
     * function callBackfunction(layer){
     *  console.log(layer)
     * }
     *
     * // layers 属性类似二维服务
     * // layers=show:0,1 表示只显示 layerIndex 为 0, 1 的图层
     * // layers=hide:0,1 表示只隐藏 layerIndex 为 0, 1 的图层
     *
     * let result = m3d.append('http://develop.smaryun.com:6163/igs/rest/g3d/ModelM3D, {
     *  autoReset:false,
     *  synchronous:true,
     *  showBoundingVolume:false,
     *  maximumScreenSpaceError:16,
     *  layers:'layers=show:0',
     *  loaded:callBackfunction
     * });
     *
     */
    append(url, optionsParam) {
        if (!Cesium.defined(url)) {
            return new Cesium.DeveloperError('必须指定url');
        }
        const options = Cesium.defaultValue(optionsParam, {});
        let synchronous = true;
        const baseUrl = url;
        let resource;
        let proxy;
        const docLayers = [];

        const layersString = Cesium.defaultValue(options.layers, '');

        let layersVec = layersString.split('=');

        let layerShow = true;
        let indexArray = [];

        if (layersVec.length === 2) {
            var tmpString = layersVec[1];
            layersVec = tmpString.split(':');

            if (layersVec.length === 2) {
                if (layersVec[0] === 'show') {
                    layerShow = true;
                } else if (layersVec[0] === 'hide') {
                    layerShow = false;
                } else {
                    // eslint-disable-next-line no-console
                    console.log('layers 参数输入错误：' + layersString);
                }

                tmpString = layersVec[1];
                layersVec = tmpString.split(',');

                if (layersVec.length > 0) {
                    for (var index = 0; index &lt; layersVec.length; index++) {
                        indexArray.push(parseInt(layersVec[index]));
                    }
                }
            }
        }

        if (Cesium.defined(options)) {
            if (Cesium.defined(options.proxy)) {
                // 不放在defaultValue中 new 会影响性能
                proxy = new Cesium.DefaultProxy(options.proxy);
            }
            Cesium.defaultValue(options.proxy, undefined);
            synchronous = Cesium.defaultValue(options.synchronous, true);
        }

        const _callBack = (params) => {
            const _params = params;
            if (Cesium.defined(options.loaded) &amp;&amp; typeof options.loaded === 'function') {
                options.loaded(_params);
            }
        };

        const parseDocInfo = (info) => {
            if (info !== undefined &amp;&amp; info.sceneInfos.length > 0) {
                const { layers } = info.sceneInfos[0];
                layers.forEach((layer) => {
                    const type = parseInt(layer.layerType, 10);
                    if (type === LayerType.M3DLAYER) {
                        const { layerRenderIndex, layerIndex, gdbpUrl, isVisible } = layer;

                        let isShow = true;

                        if (layersString.length > 7 &amp;&amp; indexArray.length > 0) {
                            isShow = (indexArray.indexOf(layerIndex) !== -1) === layerShow;
                        } else {
                            isShow = isVisible;
                        }

                        const m3d = this.appendM3DLayer(baseUrl, layerRenderIndex, layerIndex, gdbpUrl, isShow, true, options);
                        docLayers.push(m3d);
                        m3d.readyPromise.then(_callBack);
                    }
                });
            }
        };

        const getDoc = '/GetDocInfo';
        const requestUrl = `${baseUrl}${getDoc}`;
        if (synchronous) {
            resource = new Cesium.Resource({
                url: requestUrl,
                proxy
            });
            resource.fetchJson().then((json) => parseDocInfo(json));
        } else {
            const request = new Cesium.XMLHttpRequest();
            request.open('GET', requestUrl, false);
            request.send(null);
            if (request.status === 200) {
                const info = Cesium.JSON.parse(request.responseText);
                if (info) {
                    parseDocInfo(info);
                }
            }
        }
        return docLayers;
    }

    /**
     * 添加m3d服务图层（mongodb）
     * @function module:客户端数据服务.M3DLayer.prototype.appendM3dCacheFromMangoDB
     * @param {String} url 服务地址（发布的m3d缓存服务）
     * @param {Object} optionsParam 包含以下参数
     * @param {Boolean} [optionsParam.autoReset = true] 是否自动复位
     * @param {Function} [optionsParam.loaded = function] 回调函数
     * @param {DefaultProxy} 代理
     * @example
     * let view = { viewer: window.globe.viewer };
       let m3d = new M3DLayer(view);
       function callBackfunction(layer){
       }
       m3d.appendM3dLayer('http://localhost:6163/igs/rest/g3d/cache/jg', {
       autoReset:false
       loaded:callBackfunction
       });
     */
    appendM3dCacheFromMangoDB(baseUrl, optionsParam) {
        const options = Cesium.defaultValue(optionsParam, {});
        let proxy;
        let autoReset = true;
        if (Cesium.defined(options)) {
            if (Cesium.defined(options.proxy)) {
                proxy = new Cesium.DefaultProxy(options.proxy);
            }
            Cesium.defaultValue(options.proxy, undefined);
            autoReset = Cesium.defaultValue(options.autoReset, true);
        }
        const resource = new Cesium.Resource({
            url: `${baseUrl}/GetCacheInfo`,
            proxy
        });
        const layer = [];

        resource.fetchJson().then((json) => {
            if (Cesium.defined(json)) {
                const dataUrlCache = `${baseUrl}/GetDataStreams?`;
                const m3dLayrCache = new Cesium.MapGISM3DSet({
                    url: dataUrlCache,
                    igserver: true
                });
                const cacheLayer = this.viewer.scene.primitives.add(m3dLayrCache);
                layer.push(cacheLayer);
                layer.readyPromise.then((tileSet) => {
                    if (autoReset) {
                        const { boundingSphere } = tileSet;
                        this.viewer.camera.viewBoundingSphere(boundingSphere, new Cesium.HeadingPitchRange(0.0, -0.5, boundingSphere.radius));
                        this.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
                        if (typeof options.loaded === 'function') {
                            options.loaded(tileSet);
                        }
                    }
                });
            }
        });

        return layer;
    }

    /**
     * 设置模型层按方向移动
     * @function module:客户端数据服务.M3DLayer.prototype.setM3dLayerMovement
     * @param {MapGISM3DSet} layer m3d图层对象
     * @param {Cartesian3} direction 移动方向
     * @param {Number} distance 移动距离
     * @example
     *  let tilelayer = m3d.append('http://develop.smaryun.com:6163/igs/rest/g3d/ModelM3D',{});
     *  let dir = new Cesium.Cartesian3(0.0, 1.0, 1.0); 分别表示xyz方向
     *  m3d.setM3dLayerMovement(tilelayer[0],dir,10.0)
     */
    setM3dLayerMovement(tileSet, direction, distance) {
        if (undefined === tileSet || undefined === direction || undefined === distance) {
            return false;
        }
        if (undefined === tileSet._root) {
            return false;
        }
        Cesium.Cartesian3.normalize(direction, direction);
        Cesium.Cartesian3.multiplyByScalar(direction, distance, direction);
        const worldPoint = Cesium.Matrix4.multiplyByPoint(tileSet._root.transform, direction, new Cesium.Cartesian3());
        const matrix = Cesium.Matrix4.setTranslation(tileSet._root.transform, worldPoint, new Cesium.Matrix4());
        const { _root } = tileSet;
        _root.transform = matrix;
        this.scene.requestRender();
        return true;
    }

    /**
     * 设置模型定位点
     * @function module:客户端数据服务.M3DLayer.prototype.setM3dLayerLocation
     * @param {Object} layer m3d图层对象
     * @param {Number} longtitude 经度
     * @param {Number} latitude  纬度
     * @example
     * tilelayer = m3d.append('http://develop.smaryun.com:6163/igs/rest/g3d/ModelM3D',{});
     * m3d.setM3dLayerLocation(tilelayer[0],103.0,30.0);
     */
    setM3dLayerLocation(tileSet, longtitude, latitude) {
        if (undefined === tileSet) {
            return false;
        }
        if (undefined === tileSet._root) {
            return false;
        }
        let hpr = new Cesium.Matrix3();
        const hprObj = new Cesium.HeadingPitchRoll(Cesium.Math.PI, Cesium.Math.PI, Cesium.Math.PI);
        hpr = Cesium.Matrix3.fromHeadingPitchRoll(hprObj, hpr);
        const modelMatrix = Cesium.Matrix4.multiplyByTranslation(
            Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(longtitude, latitude, 0)),
            new Cesium.Cartesian3(),
            new Cesium.Matrix4()
        );
        Cesium.Matrix4.multiplyByMatrix3(modelMatrix, hpr, modelMatrix);
        const { _root } = tileSet;
        _root.transform = modelMatrix;
        this.scene.requestRender();
        return true;
    }
}

CesiumZondy.Layer.M3DLayer = M3DLayer;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>文档生成<a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://www.smaryun.com" target="_blank">司马云</a> <span>© 2020 云生态圈</span>
                        <a href="http://develop.smaryun.com:8899/" target="_blank">MapGIS Client for JavaScript</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>

</body>
</html>
